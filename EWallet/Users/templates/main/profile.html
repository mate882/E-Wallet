{% load static %}

<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

<div class="container-fluid py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
      <div class="row">
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
              <form method="POST" enctype="multipart/form-data" class="mb-3">
                {% csrf_token %}
                <input type="file" id="profileInput" name="profile_pic" accept="image/*" 
                      class="d-none" onchange="this.form.submit()">
                <label for="profileInput" class="d-block mb-3" role="button">
                    {% if request.user.profile_pic %}
                        <img src="{{ request.user.profile_pic.url }}" 
                            class="img-thumbnail rounded-circle shadow" 
                            style="width: 180px; height: 180px; object-fit: cover;" 
                            alt="Profile Picture">
                    {% else %}
                        <img src="{% static 'images/default-avatar.png' %}" 
                            class="img-thumbnail rounded-circle shadow" 
                            style="width: 180px; height: 180px; object-fit: cover;" 
                            alt="Default Picture">
                    {% endif %}
                </label>
              </form>

              <form method="POST" action="{% url 'delete_profile_pic' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm mb-3" 
                    onclick="return confirm('Are you sure you want to delete your profile picture?');"
                    {% if not request.user.profile_pic %} disabled {% endif %}>
                  Delete Picture
                </button>
              </form>

              <div class="d-grid">
                <a class="btn btn-outline-danger" href="{% url 'logout' %}">Logout</a>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="row g-3 mb-4">
            <div class="col-sm-6">
              <div class="card shadow-sm h-100">
                <div class="card-body">
                  <h6 class="card-title fw-bold mb-2">ID</h6>
                  <p class="text-primary mb-0">{{ user.id }}</p>
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="card shadow-sm h-100">
                <div class="card-body">
                  <h6 class="card-title fw-bold mb-2">Date of Joining</h6>
                  <p class="text-primary mb-0">{{ user.date_joined }}</p>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h6 class="card-title fw-bold mb-2">Email</h6>
                  <p class="text-primary mb-0">{{ user.email }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="card shadow-sm">
            <div class="card-body">
              {% block content %}
              <h2 class="text-primary mb-4">Profile</h2>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <strong>Email:</strong> {{ user.email }}
                </div>
              </div>
              
              {% if wallet %}
                <hr class="my-4">
                <h3 class="text-success mb-3">Wallet Summary</h3>
                <div class="row align-items-center">
                  <div class="col-md-6">
                    <p class="mb-2"><strong>Balance:</strong> ${{ wallet.balance }}</p>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'transactions_history' %}" class="btn btn-info">View Transaction History</a>
                  </div>
                </div>
              {% else %}
                <div class="alert alert-warning mt-4">
                  <p class="mb-0">You don't have a wallet yet. <a href="{% url 'create_wallet' %}" class="alert-link">Create one here</a>.</p>
                </div>
              {% endif %}
              
              <hr class="my-4">
              <a href="{% url 'home' %}" class="btn btn-secondary">Back to Dashboard</a>
              {% endblock %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>